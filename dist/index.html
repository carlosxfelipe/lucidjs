<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Contador Persistente com Lucid.js</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <main class="container max-w-2xl mx-auto p-6">
      <h1 class="text-3xl font-bold text-center mb-8 text-gray-900 dark:text-white">
        Contador Persistente
      </h1>
      <div id="app"></div>
    </main>

    <script type="module">
      import * as Lucid from "https://cdn.jsdelivr.net/gh/carlosxfelipe/lucidjs@main/dist/lucid.min.js";
      /** @jsx Lucid.h */
      const { h, mount, createMemo, createStorageSignal, batch } = Lucid;

      const Counter = (props) => {
        const initial = props.initial ?? 0;
        const resetTo = props.resetTo ?? 0;

        // Signal persistente para o contador
        const [count, setCount] = createStorageSignal("app.counter.signal", initial);
        const doubled = createMemo(() => count() * 2);

        // Ações
        const inc = () => setCount((c) => c + 1);
        const dec = () => setCount((c) => Math.max(0, c - 1));
        const reset = (to = resetTo) => setCount(to);
        const plusTwo = () =>
          batch(() => {
            inc();
            inc();
          });
        const isAtReset = createMemo(() => count() === resetTo);

        return h(
          "article",
          { class: "space-y-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6" },
          h(
            "div",
            { class: "grid gap-1 mb-3" },
            h(
              "div",
              { class: "text-gray-900 dark:text-white" },
              "Valor: ",
              h("span", { class: "font-semibold" }, count)
            ),
            h(
              "div",
              { class: "text-gray-600 dark:text-gray-400" },
              "Dobro (memo): ",
              h("span", { class: "font-semibold" }, doubled)
            )
          ),
          h(
            "div",
            { role: "group", class: "grid grid-cols-2 md:grid-cols-4 gap-3" },
            h(
              "button",
              {
                type: "button",
                class: "bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium py-2 px-4 rounded-md border border-gray-600 hover:border-gray-700 transition-colors duration-200",
                onClick: dec,
                disabled: () => count() <= 0,
                "aria-label": "decrement by one"
              },
              "−1"
            ),
            h(
              "button",
              {
                type: "button",
                class: "bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200",
                onClick: inc,
                "aria-label": "increment by one"
              },
              "+1"
            ),
            h(
              "button",
              {
                type: "button",
                class: "bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md border border-blue-600 hover:border-blue-700 transition-colors duration-200",
                onClick: plusTwo,
                "aria-label": "increment twice in batch"
              },
              "+2 (batch)"
            ),
            h(
              "button",
              {
                type: "button",
                class: "bg-gray-800 hover:bg-gray-900 disabled:bg-gray-500 disabled:cursor-not-allowed text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 dark:bg-gray-700 dark:hover:bg-gray-600",
                onClick: () => reset(resetTo),
                disabled: isAtReset,
                "aria-label": "reset counter"
              },
              "reset"
            )
          )
        );
      };

      mount(h(Counter, { initial: 0, resetTo: 0 }), document.querySelector("#app"));
    </script>
  </body>
</html>
